<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日志调试页面</title>
</head>
<body>
    <h1>日志数据调试</h1>
    <div id="output"></div>
    
    <script>
        // 模拟localStorage操作
        const STORAGE_KEYS = {
            LOGS: 'bd_logs'
        };
        
        class LocalStorageManager {
            static get(key, defaultValue) {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : defaultValue;
                } catch (error) {
                    console.error('获取localStorage数据失败:', error);
                    return defaultValue;
                }
            }
            
            static set(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch (error) {
                    console.error('设置localStorage数据失败:', error);
                    return false;
                }
            }
        }
        
        // 初始化演示日志数据
        function initializeDemoLogs() {
            const logs = LocalStorageManager.get(STORAGE_KEYS.LOGS, []);
            if (logs.length === 0) {
                const now = new Date();
                const demoLogs = [
                    {
                        id: 1,
                        user_id: '1',
                        username: 'admin',
                        action: 'LOGIN',
                        resource: 'AUTH',
                        details: '用户登录系统',
                        ip_address: '192.168.1.100',
                        user_agent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                        created_at: new Date(now.getTime() - 2 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: 2,
                        user_id: '1',
                        username: 'admin',
                        action: 'HEALTH_EVALUATE',
                        resource: 'EVALUATION',
                        details: '执行健康评估',
                        ip_address: '192.168.1.100',
                        user_agent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                        created_at: new Date(now.getTime() - 1 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: 3,
                        user_id: '2',
                        username: 'user',
                        action: 'UPLOAD_DATA',
                        resource: 'DATA',
                        details: '上传数据文件',
                        ip_address: '192.168.1.101',
                        user_agent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36',
                        created_at: new Date(now.getTime() - 30 * 60 * 1000).toISOString()
                    }
                ];
                LocalStorageManager.set(STORAGE_KEYS.LOGS, demoLogs);
                console.log('演示日志数据已初始化');
            }
        }
        
        // 测试日志数据
        function testLogs() {
            console.log('开始测试日志数据...');
            
            // 初始化数据
            initializeDemoLogs();
            
            // 获取日志数据
            const logs = LocalStorageManager.get(STORAGE_KEYS.LOGS, []);
            console.log('获取到的日志数据:', logs);
            
            // 显示在页面上
            const output = document.getElementById('output');
            output.innerHTML = `
                <h2>日志数据 (${logs.length} 条)</h2>
                <pre>${JSON.stringify(logs, null, 2)}</pre>
            `;
        }
        
        // 页面加载完成后执行测试
        window.onload = testLogs;
    </script>
</body>
</html>
